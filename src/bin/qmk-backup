#! /usr/bin/env python3
import os
import argparse
from pathlib import Path

TEMP_DIR = os.popen('wslupath -T').read().strip()

BACKUP_SRC = '/home/qmk'
BACKUP_DEST = os.getenv('BACKUP_DEST', f'{TEMP_DIR}/qmk_wsl_backup')

parser = argparse.ArgumentParser()
parser.add_argument('-r', '--restore', action='store_true')
parser.add_argument('-l', '--location', default=BACKUP_DEST)

args = parser.parse_args()

backup_folder = args.location
first_run = not (Path(BACKUP_SRC) / 'qmk_firmware').exists()

if args.restore:
    os.system(f'cp -rfT {backup_folder} {BACKUP_SRC}/')
else:
    if first_run:
        os.system(f'cp -rfT {BACKUP_SRC} {backup_folder}/')
    else:
        os.system(f'rsync -avAXW --delete {BACKUP_SRC}/ {backup_folder}')
